stages:
  - supermicro
  - equinix
  - dell-r620
  - applications

# supermicro deployment
supermicro:
  stage: supermicro
  variables:
    SSH_HOST: "${SSH_HOST}"
    SSH_PASSWORD: "${SSH_PASSWORD}"
  only:
     variables:
      - $TARGET_SERVER == "supermicro"
  trigger:
    # Include the configuration file of the child pipeline
    include: inventories/supermicro/.gitlab-ci.yml
  rules:

# dell-r620 deployment
dell-r620:
  stage: dell-r620
  variables:
    SSH_HOST: "${SSH_HOST}"
    SSH_PASSWORD: "${SSH_PASSWORD}"
  only:
     variables:
      - $TARGET_SERVER == "dell-r620"
  trigger:
    # Include the configuration file of the child pipeline
    include: inventories/dell-r620/.gitlab-ci.yml
  rules:


# equinix deployment
equinix:
  stage: equinix
  variables:
    SSH_HOST: "${SSH_HOST}"
    SSH_PASSWORD: "${SSH_PASSWORD}"
  only:
     variables:
      - $TARGET_SERVER == "equinix"
  trigger:
    include: inventories/equinix/.gitlab-ci.yml

# freeipa deployment
applications:
  stage: applications
  variables:
    SSH_HOST: "${SSH_HOST}"
    SSH_USER: "${SSH_USER}"
    SSH_PASSWORD: "${SSH_PASSWORD}"
    INVENTORY: "${INVENTORY}"
    ROCKY: "${ROCKY}"
  only:
     variables:
      - $DEPLOY_APP == "freeipa"
  trigger:
    include: applications/freeipa/.gitlab-ci.yml
