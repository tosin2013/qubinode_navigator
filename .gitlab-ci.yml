stages:
  - build

build:
  stage: build
  image: fedora:37
  variables:
    SSH_USER: admin
    SSH_PASSWORD: COmp123$%
    SSH_HOST: 192.168.1.39
    CICD_PIPELINE: 'true'
    ENV_USERNAME: admin
    DOMAIN: qubinodelab.io
    FORWARDER: '1.1.1.1'
    ACTIVE_BRIDGE: 'true'
    INTERFACE: eno1
    DISK: /dev/nvme0n1
  script:
    - dnf install wget openssh-clients sshpass -y
    - mkdir -p ~/.ssh/
    - ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa -N ""
    - sshpass -p "$SSH_PASSWORD" ssh-copy-id -o StrictHostKeyChecking=no "$SSH_USER"@"$SSH_HOST"
    - ssh "$SSH_USER"@"$SSH_HOST"  'env CICD_PIPELINE="'$CICD_PIPELINE'" ENV_USERNAME="'$ENV_USERNAME'" DOMAIN="'$DOMAIN'" FORWARDER="'$FORWARDER'" ACTIVE_BRIDGE="'$ACTIVE_BRIDGE'" INTERFACE="'$INTERFACE'" DISK="'$DISK'"  bash -s' < setup.sh
  only:
    - main
