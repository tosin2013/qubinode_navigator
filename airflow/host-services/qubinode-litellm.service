# Qubinode LiteLLM Proxy Service - Systemd Unit File
# ADR-0050: Hybrid Host-Container Architecture
#
# Install: cp qubinode-litellm.service /etc/systemd/system/
# Enable:  systemctl enable --now qubinode-litellm.service
# Status:  systemctl status qubinode-litellm.service
# Logs:    journalctl -u qubinode-litellm.service -f

[Unit]
Description=Qubinode LiteLLM Proxy (Multi-model routing)
Documentation=https://github.com/Qubinode/qubinode_navigator
After=network.target

# Start after Ollama (primary backend)
After=ollama.service
Wants=ollama.service

[Service]
Type=simple
User=root
Group=root

# Working directory
WorkingDirectory=/opt/qubinode

# Environment - API Keys (set these in /etc/qubinode/litellm.env)
EnvironmentFile=-/etc/qubinode/litellm.env

# Master key for LiteLLM API authentication
# Generate with: openssl rand -hex 32
Environment=LITELLM_MASTER_KEY=change-this-in-production

# Start command
ExecStart=/usr/local/bin/litellm \
    --config /opt/qubinode/config/litellm_config.yaml \
    --port 4000 \
    --host 0.0.0.0 \
    --num_workers 2

# Restart policy
Restart=always
RestartSec=10

# Resource limits
MemoryMax=1G
MemoryHigh=512M

# Security hardening
NoNewPrivileges=true
ProtectSystem=strict
ProtectHome=read-only
ReadWritePaths=/var/log/litellm
PrivateTmp=true

# Logging
StandardOutput=journal
StandardError=journal
SyslogIdentifier=qubinode-litellm

[Install]
WantedBy=multi-user.target
